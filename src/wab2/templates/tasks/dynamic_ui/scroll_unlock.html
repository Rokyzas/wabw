<!-- {{ task.agent.scenario_title }} - {{ task.agent.goal_description }} - Task ID: {{ task.id }} -->

<div class="policy-container">
    <div class="policy-header">
        <h3>Privacy Policy</h3>
        <p class="policy-subtitle">Last updated: July 2023</p>
    </div>
    
    <div class="policy-content-wrapper">
        <div class="scroll-indicator">
            <div class="arrow">↓</div>
            <span>Scroll to review all terms</span>
        </div>
        
        <div class="policy-content" id="policy-text">
            <h4>1. Introduction</h4>
            <p>Welcome to our Privacy Policy. This document explains how we collect, use, and protect your personal information when you use our services. Please read this carefully to understand our practices regarding your data.</p>
            
            <p>By accessing or using our services, you agree to the collection and use of information in accordance with this policy. We are committed to protecting your privacy and ensuring the security of your personal information.</p>
            
            <h4>2. Information We Collect</h4>
            <p>We collect several different types of information for various purposes to provide and improve our services to you:</p>
            
            <h5>2.1 Personal Information</h5>
            <p>While using our services, we may ask you to provide us with certain personally identifiable information that can be used to contact or identify you. This may include:</p>
            <ul>
                <li>Name and contact details</li>
                <li>Email address</li>
                <li>Phone number</li>
                <li>Address information</li>
                <li>Payment details</li>
            </ul>
            
            <h5>2.2 Usage Data</h5>
            <p>We may also collect information about how you access and use our services, including:</p>
            <ul>
                <li>Your device's IP address</li>
                <li>Browser type and version</li>
                <li>Pages visited and time spent</li>
                <li>Time and date of your visit</li>
                <li>Other diagnostic data</li>
            </ul>
            
            <h5>2.3 Cookies and Tracking</h5>
            <p>We use cookies and similar tracking technologies to track activity on our services and hold certain information. Cookies are files with small amounts of data which may include an anonymous unique identifier.</p>
            
            <p>You can instruct your browser to refuse all cookies or to indicate when a cookie is being sent. However, if you do not accept cookies, you may not be able to use some portions of our services.</p>
            
            <h4>3. How We Use Your Information</h4>
            <p>We use the information we collect for various purposes, including:</p>
            <ul>
                <li>To provide and maintain our services</li>
                <li>To notify you about changes to our services</li>
                <li>To allow you to participate in interactive features</li>
                <li>To provide customer support</li>
                <li>To gather analysis or valuable information to improve our services</li>
                <li>To monitor the usage of our services</li>
                <li>To detect, prevent, and address technical issues</li>
            </ul>
            
            <h4>4. Data Retention</h4>
            <p>We will retain your personal information only for as long as is necessary for the purposes set out in this Privacy Policy. We will retain and use your information to the extent necessary to comply with our legal obligations, resolve disputes, and enforce our policies.</p>
            
            <h4>5. Data Security</h4>
            <p>The security of your data is important to us, but remember that no method of transmission over the Internet or method of electronic storage is 100% secure. While we strive to use commercially acceptable means to protect your personal information, we cannot guarantee its absolute security.</p>
            
            <h4>6. Your Data Protection Rights</h4>
            <p>Depending on your location, you may have certain rights regarding your personal information, such as:</p>
            <ul>
                <li>The right to access, update, or delete your information</li>
                <li>The right to rectification (to correct information)</li>
                <li>The right to object (to processing of your information)</li>
                <li>The right of restriction (to limit processing)</li>
                <li>The right to data portability</li>
                <li>The right to withdraw consent</li>
            </ul>
            
            <h4>7. Third-Party Services</h4>
            <p>Our services may contain links to other sites that are not operated by us. If you click on a third-party link, you will be directed to that third party's site. We strongly advise you to review the Privacy Policy of every site you visit.</p>
            
            <p>We have no control over and assume no responsibility for the content, privacy policies, or practices of any third-party sites or services.</p>
            
            <h4>8. Children's Privacy</h4>
            <p>Our services do not address anyone under the age of 18. We do not knowingly collect personally identifiable information from anyone under the age of 18. If you are a parent or guardian and you are aware that your child has provided us with personal data, please contact us.</p>
            
            <h4>9. Changes to This Privacy Policy</h4>
            <p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date at the top of this page.</p>
            
            <p>You are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page.</p>
            
            <h4>10. Contact Us</h4>
            <p>If you have any questions about this Privacy Policy, please contact us:</p>
            <ul>
                <li>By email: privacy@example.com</li>
                <li>By visiting our website: www.example.com/contact</li>
                <li>By phone: +1 (555) 123-4567</li>
            </ul>
            
            <div class="end-of-policy">
                <p>— End of Privacy Policy —</p>
            </div>
        </div>
    </div>
    
    <div class="policy-actions">
        <label class="acceptance-label">
            <input type="checkbox" id="acceptance-checkbox" disabled>
            <span>I have read and agree to the Privacy Policy</span>
        </label>
        <button id="accept-button" class="btn btn-primary">Accept</button>
    </div>
    
    <div id="reading-progress" class="reading-progress">
        <div class="progress-text">Read progress: <span id="progress-percentage">0%</span></div>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-bar-fill"></div>
        </div>
    </div>
</div>

<style>
    /* Policy Container */
    .policy-container {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
        overflow: hidden;
        max-width: 900px;
        margin: 0 auto;
    }
    
    .policy-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid #e0e0e0;
        background-color: #f8f9fa;
    }
    
    .policy-header h3 {
        margin: 0 0 0.5rem 0;
        color: #333;
        font-size: 1.5rem;
    }
    
    .policy-subtitle {
        margin: 0;
        color: #666;
        font-size: 0.9rem;
    }
    
    /* Policy Content */
    .policy-content-wrapper {
        position: relative;
        padding: 0 2rem;
        max-height: 400px;
        overflow: hidden;
    }
    
    .policy-content {
        height: 350px;
        overflow-y: auto;
        padding: 1.5rem 0;
        scrollbar-width: thin;
        scrollbar-color: #c1c1c1 #f1f1f1;
    }
    
    .policy-content::-webkit-scrollbar {
        width: 8px;
    }
    
    .policy-content::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .policy-content::-webkit-scrollbar-thumb {
        background: #c1c1c1;
        border-radius: 4px;
    }
    
    .policy-content::-webkit-scrollbar-thumb:hover {
        background: #a1a1a1;
    }
    
    .policy-content h4 {
        color: #333;
        margin: 1.5rem 0 1rem;
        font-size: 1.2rem;
    }
    
    .policy-content h4:first-child {
        margin-top: 0;
    }
    
    .policy-content h5 {
        color: #444;
        margin: 1.25rem 0 0.75rem;
        font-size: 1.05rem;
    }
    
    .policy-content p {
        margin-bottom: 1rem;
        line-height: 1.6;
        color: #555;
    }
    
    .policy-content ul {
        margin-bottom: 1rem;
        padding-left: 2rem;
    }
    
    .policy-content li {
        margin-bottom: 0.5rem;
        color: #555;
    }
    
    .end-of-policy {
        text-align: center;
        margin: 2rem 0 1rem;
        padding-top: 1rem;
        border-top: 1px solid #eee;
        color: #666;
        font-style: italic;
    }
    
    /* Scroll Indicator */
    .scroll-indicator {
        position: absolute;
        bottom: 15px;
        left: 50%;
        transform: translateX(-50%);
        background-color: rgba(255, 255, 255, 0.9);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: flex;
        align-items: center;
        gap: 0.5rem;
        z-index: 10;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        opacity: 1;
        visibility: visible;
    }
    
    .scroll-indicator.hidden {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
    }
    
    .scroll-indicator .arrow {
        animation: bounce 1.5s infinite;
        font-size: 1.2rem;
    }
    
    @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {
            transform: translateY(0);
        }
        40% {
            transform: translateY(-5px);
        }
        60% {
            transform: translateY(-3px);
        }
    }
    
    /* Policy Actions */
    .policy-actions {
        padding: 1.5rem 2rem;
        border-top: 1px solid #e0e0e0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        background-color: #f8f9fa;
    }
    
    .acceptance-label {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        cursor: pointer;
        user-select: none;
        position: relative;
    }
    
    .acceptance-label input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        cursor: pointer;
        height: 0;
        width: 0;
    }
    
    .acceptance-label span {
        font-weight: 500;
        color: #333;
        padding-left: 28px;
        position: relative;
    }
    
    .acceptance-label span:before {
        content: '';
        position: absolute;
        left: 0;
        top: 2px;
        width: 18px;
        height: 18px;
        border: 1px solid #ccc;
        background-color: #fff;
        border-radius: 3px;
        transition: all 0.2s ease;
    }
    
    .acceptance-label span:after {
        content: '';
        position: absolute;
        left: 6px;
        top: 6px;
        width: 6px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
        display: none;
        transition: all 0.2s ease;
    }
    
    .acceptance-label:hover input[type="checkbox"]:not(:disabled) + span:before {
        border-color: #4285f4;
    }
    
    .acceptance-label input[type="checkbox"]:checked + span:before {
        background-color: #4285f4;
        border-color: #4285f4;
    }
    
    .acceptance-label input[type="checkbox"]:checked + span:after {
        display: block;
    }
    
    .acceptance-label input[type="checkbox"]:focus + span:before {
        box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.2);
    }
    
    .acceptance-label input[type="checkbox"]:disabled + span:before {
        background-color: #f5f5f5;
        border-color: #ddd;
        cursor: not-allowed;
    }
    
    /* Reading Progress */
    .reading-progress {
        padding: 0.75rem 2rem 1.5rem;
        background-color: #f8f9fa;
    }
    
    .progress-text {
        color: #666;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }
    
    .progress-bar {
        height: 6px;
        background-color: #e0e0e0;
        border-radius: 3px;
        overflow: hidden;
    }
    
    .progress-fill {
        height: 100%;
        width: 0%;
        background-color: #4285f4;
        border-radius: 3px;
        transition: width 0.3s ease;
    }
    
    /* Buttons */
    .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        min-width: 120px;
    }
    
    .btn-primary {
        background-color: #4285f4;
        color: white;
    }
    
    .btn-primary:hover:not(:disabled) {
        background-color: #3367d6;
    }
    
    /* When button becomes enabled, add a pulse animation */
    @keyframes pulse-button {
        0% { box-shadow: 0 0 0 0 rgba(66, 133, 244, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(66, 133, 244, 0); }
        100% { box-shadow: 0 0 0 0 rgba(66, 133, 244, 0); }
    }
    
    .btn-pulse {
        animation: pulse-button 2s infinite;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const policyContent = document.getElementById('policy-text');
    const acceptanceCheckbox = document.getElementById('acceptance-checkbox');
    const acceptButton = document.getElementById('accept-button');
    const progressPercentage = document.getElementById('progress-percentage');
    const progressBarFill = document.getElementById('progress-bar-fill');
    const scrollIndicator = document.querySelector('.scroll-indicator');
    
    // State
    let hasReachedBottom = false;
    let isTaskComplete = false;
    let prevScrollTop = 0;
    
    // Define fallback functions if they don't exist in the global scope
    if (typeof window.completeTask !== 'function') {
        window.completeTask = function(success) {
            console.log('Task completed:', success);
        };
    }
    
    if (typeof window.recordMistake !== 'function') {
        window.recordMistake = function(code, details, message) {
            console.log('Mistake recorded:', code, details, message);
        };
    }
    
    // Calculate scroll percentage
    function calculateScrollPercentage() {
        const element = policyContent;
        const scrollTop = element.scrollTop;
        const scrollHeight = element.scrollHeight;
        const clientHeight = element.clientHeight;
        
        // Calculate how far through the text the user has scrolled
        const scrollPercentage = Math.round((scrollTop / (scrollHeight - clientHeight)) * 100);
        
        // Return as a value between 0 and 100
        return Math.min(Math.max(scrollPercentage, 0), 100);
    }
    
    // Update the progress bar and percentage text
    function updateProgressDisplay(percentage) {
        progressPercentage.textContent = `${percentage}%`;
        progressBarFill.style.width = `${percentage}%`;
    }
    
    // Check if the user has reached the bottom
    function checkIfReachedBottom() {
        const scrollPercentage = calculateScrollPercentage();
        
        // Update the progress display
        updateProgressDisplay(scrollPercentage);
        
        // Check if user has scrolled to the bottom
        if (scrollPercentage >= 90 && !hasReachedBottom) {
            // User has viewed the entire document
            hasReachedBottom = true;
            
            // Enable the acceptance checkbox
            acceptanceCheckbox.disabled = false;
            
            // Hide the scroll indicator
            scrollIndicator.classList.add('hidden');
            
            // Make the checkbox stand out
            acceptanceCheckbox.parentElement.style.animation = 'pulse-button 1.5s';
            setTimeout(() => {
                acceptanceCheckbox.parentElement.style.animation = '';
            }, 1500);
        }
    }
    
    // Handle scroll events
    policyContent.addEventListener('scroll', function() {
        checkIfReachedBottom();
        
        // Show/hide scroll indicator based on scroll direction
        const currentScrollTop = policyContent.scrollTop;
        if (currentScrollTop > prevScrollTop && !hasReachedBottom) {
            // Scrolling down, hide the indicator after a brief delay
            setTimeout(() => {
                scrollIndicator.style.opacity = '0.5';
            }, 1000);
        } else if (currentScrollTop < prevScrollTop) {
            // Scrolling up, show the indicator
            scrollIndicator.style.opacity = '1';
        }
        
        prevScrollTop = currentScrollTop;
    });
    
    // Handle checkbox state change
    acceptanceCheckbox.addEventListener('change', function() {
        if (this.checked) {
            // Add pulse effect to accept button
            acceptButton.classList.add('btn-pulse');
        } else {
            // Remove pulse effect from accept button
            acceptButton.classList.remove('btn-pulse');
        }
    });
    
    // Handle accept button click
    acceptButton.addEventListener('click', function() {
        if (!hasReachedBottom) {
            if (window.recordMistake) {
                window.recordMistake(
                    'incomplete_scroll',
                    'User attempted to accept without scrolling through the entire policy',
                    'Please scroll through the entire policy before accepting.'
                );
            }
            
            // Highlight the scroll area
            policyContent.style.boxShadow = '0 0 8px rgba(220, 53, 69, 0.5)';
            setTimeout(() => {
                policyContent.style.boxShadow = '';
            }, 2000);
            
            return;
        }
        
        if (!acceptanceCheckbox.checked) {
            if (window.recordMistake) {
                window.recordMistake(
                    'checkbox_unchecked',
                    'User attempted to accept without checking the agreement box',
                    'Please check the box to confirm you agree to the policy.'
                );
            }
            
            // Highlight the checkbox
            acceptanceCheckbox.parentElement.style.animation = 'pulse-button 1.5s';
            setTimeout(() => {
                acceptanceCheckbox.parentElement.style.animation = '';
            }, 1500);
            
            return;
        }
        
        if (hasReachedBottom && acceptanceCheckbox.checked && !isTaskComplete) {
            completeTask();
        }
    });
    
    // Task completion
    function completeTask() {
        isTaskComplete = true;
        
        // Update UI
        acceptButton.classList.remove('btn-pulse');
        acceptButton.textContent = 'Accepted';
        
        // Complete the task
        if (window.completeTask) {
            window.completeTask(true);
        }
    }
    
    // Initialize the progress display
    updateProgressDisplay(0);
});
</script> 