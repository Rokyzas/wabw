<main>
    <div id="file-container">
        <!-- Files -->
        <div class="file-item">
            <div class="file-icon" data-type="pdf">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#e53935" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M9.5,15H8v-5h2 c1.1,0,2,0.9,2,2v1C12,14.1,11.1,15,9.5,15z M16,15h-1.5v-1.5h-2V15H11v-5h5V15z M9.5,12h1v-1h-1V12z M13.5,12h1v-1h-1V12z"/>
                </svg>
            </div>
            <div class="file-name">Report.pdf</div>
        </div>
        
        <div class="file-item">
            <div class="file-icon" data-type="xlsx">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#4caf50" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M9,17H7v-5h2V17z M13,17 h-2v-5h2V17z M17,17h-2v-5h2V17z"/>
                </svg>
            </div>
            <div class="file-name">Budget.xlsx</div>
        </div>
        
        <div class="file-item">
            <div class="file-icon" data-type="docx">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#2196f3" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M16,13H8v-2h8V13z M16,9 H8V7h8V9z M8,15h5v2H8V15z"/>
                </svg>
            </div>
            <div class="file-name">Contract.docx</div>
        </div>
        
        <div class="file-item" id="target-file">
            <div class="file-icon" data-type="pptx">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#ff9800" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M13,5h2.5v2h-2.5V5z M13,10 h2.5v2h-2.5V10z M13,15h2.5v2h-2.5V15z M8.5,5H11v2H8.5V5z M8.5,10H11v2H8.5V10z M8.5,15H11v2H8.5V15z"/>
                </svg>
            </div>
            <div class="file-name">Presentation.pptx</div>
        </div>
        
        <div class="file-item">
            <div class="file-icon" data-type="jpg">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#8e24aa" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M9,16c-0.8,0-1.5-0.7-1.5-1.5 S8.2,13,9,13s1.5,0.7,1.5,1.5S9.8,16,9,16z M12,13l1.5,2h-9l3-4l2,2.7L12,13z M16,16c-0.8,0-1.5-0.7-1.5-1.5S15.2,13,16,13 s1.5,0.7,1.5,1.5S16.8,16,16,16z"/>
                </svg>
            </div>
            <div class="file-name">Image.jpg</div>
        </div>
        
        <div class="file-item">
            <div class="file-icon" data-type="zip">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="#795548" d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M14,14h-2v2h-2v-2h-2v-2h2 v-2h2v2h2V14z"/>
                </svg>
            </div>
            <div class="file-name">Archive.zip</div>
        </div>
    </div>
    
    <div id="click-status">
        <div class="status-icon waiting"></div>
        <div class="status-message">Double-click on "Presentation.pptx" to open it</div>
    </div>
</main>

<style>
    /* File Grid */
    #file-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 1.25rem;
        padding: 1.5rem;
    }
    
    .file-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem 0.5rem;
        border-radius: 8px;
        cursor: pointer;
        user-select: none;
        transition: all 0.2s ease;
        position: relative;
    }
    
    .file-item:hover {
        background-color: #f5f5f5;
    }
    
    .file-item.selected {
        background-color: #e8f0fe;
    }
    
    .file-item.clicked {
        background-color: #d2e3fc;
    }
    
    .file-icon {
        width: 48px;
        height: 48px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 0.75rem;
    }
    
    .file-icon svg {
        width: 100%;
        height: 100%;
    }
    
    .file-name {
        font-size: 0.875rem;
        color: #333;
        text-align: center;
        word-break: break-word;
    }
    
    /* Click Status */
    #click-status {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border-top: 1px solid #e0e0e0;
    }
    
    .status-icon {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }
    
    .status-icon.waiting {
        background-color: #9e9e9e;
    }
    
    .status-icon.single-click {
        background-color: #fb8c00;
    }
    
    .status-icon.success {
        background-color: #4caf50;
    }
    
    .status-message {
        font-size: 0.9rem;
        color: #555;
    }
    
    /* Target Highlight */
    #target-file {
        position: relative;
    }
    
    #target-file::after {
        content: '';
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border: 2px solid transparent;
        border-radius: 10px;
        pointer-events: none;
        transition: border-color 0.3s ease;
    }
    
    #target-file.highlight::after {
        border-color: #1a73e8;
        animation: pulse-border 2s infinite;
    }
    
    @keyframes pulse-border {
        0% { box-shadow: 0 0 0 0 rgba(26, 115, 232, 0.4); }
        70% { box-shadow: 0 0 0 8px rgba(26, 115, 232, 0); }
        100% { box-shadow: 0 0 0 0 rgba(26, 115, 232, 0); }
    }
    
    /* Animations */
    @keyframes open-file {
        0% { 
            transform: scale(1);
            opacity: 1; 
        }
        50% { 
            transform: scale(1.2); 
            opacity: 0.8;
        }
        100% { 
            transform: scale(2);
            opacity: 0; 
        }
    }
    
    .opening-animation {
        animation: open-file 0.5s forwards;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Elements
    const targetFile = document.getElementById('target-file');
    const clickStatus = document.getElementById('click-status');
    const statusIcon = clickStatus.querySelector('.status-icon');
    const statusMessage = clickStatus.querySelector('.status-message');
    
    // State
    let isTaskComplete = false;
    let lastClickTime = 0;
    let singleClickTimeout = null;
    let mistakeTimeout = null;
    
    // Constants
    const DOUBLE_CLICK_THRESHOLD = 500; // milliseconds - max time between clicks
    
    // Define fallback functions if they don't exist in the global scope
    if (typeof window.completeTask !== 'function') {
        window.completeTask = function(success) {
            console.log('Task completed:', success);
        };
    }
    
    if (typeof window.recordMistake !== 'function') {
        window.recordMistake = function(code, details, message) {
            console.log('Mistake recorded:', code, details, message);
        };
    }
    
    // Highlight the target file after a short delay
    setTimeout(() => {
        targetFile.classList.add('highlight');
    }, 1500);
    
    // Helper function to update status
    function updateStatus(type, message) {
        statusIcon.className = 'status-icon';
        statusIcon.classList.add(type);
        statusMessage.textContent = message;
    }
    
    // Handle single click
    function handleSingleClick() {
        if (isTaskComplete) return;
        
        targetFile.classList.add('clicked');
        updateStatus('single-click', 'File selected - double-click to open');
        
        // Set a timeout to record mistake only if no second click comes
        mistakeTimeout = setTimeout(() => {
            // Only record mistake if the task is still not complete
            if (!isTaskComplete) {
                window.recordMistake(
                    'single_click_only',
                    'User clicked once but needs to double-click to open the file',
                    'You need to double-click to open the file'
                );
                
                // Reset UI
                targetFile.classList.remove('clicked');
                updateStatus('waiting', 'Double-click on "Presentation.pptx" to open it');
            }
        }, DOUBLE_CLICK_THRESHOLD + 100); // Wait slightly longer than double-click threshold
    }
    
    // Handle successful double click
    function handleDoubleClick() {
        if (isTaskComplete) return;
        
        // Clear any pending mistake recording
        if (mistakeTimeout) {
            clearTimeout(mistakeTimeout);
            mistakeTimeout = null;
        }
        
        isTaskComplete = true;
        
        // Update UI
        targetFile.classList.add('opening-animation');
        updateStatus('success', 'Opening Presentation.pptx...');
        
        // Remove highlight
        targetFile.classList.remove('highlight');
        
        // Complete the task
        window.completeTask(true);
    }
    
    // Add click handlers to all files
    document.querySelectorAll('.file-item:not(#target-file)').forEach(file => {
        file.addEventListener('click', function() {
            if (isTaskComplete) return;
            
            window.recordMistake(
                'wrong_file_clicked',
                'User clicked on the wrong file',
                'Please select the Presentation.pptx file'
            );
        });
    });
    
    // Click event handler for target file
    targetFile.addEventListener('click', function(e) {
        if (isTaskComplete) return;
        
        const currentTime = new Date().getTime();
        const timeDiff = currentTime - lastClickTime;
        
        // Check for double-click
        if (timeDiff < DOUBLE_CLICK_THRESHOLD) {
            // Clear any pending single click processing
            if (singleClickTimeout) {
                clearTimeout(singleClickTimeout);
                singleClickTimeout = null;
            }
            
            // Handle as double click
            handleDoubleClick();
        } else {
            // Handle as potential first click of double click
            lastClickTime = currentTime;
            
            // Set timeout to process as single click if no second click comes
            singleClickTimeout = setTimeout(() => {
                handleSingleClick();
                singleClickTimeout = null;
            }, 50); // Small delay to wait for potential double click
        }
    });
    
    // Double-click event handler (backup for the manual detection)
    targetFile.addEventListener('dblclick', function(e) {
        if (isTaskComplete) return;
        handleDoubleClick();
    });
});
</script> 